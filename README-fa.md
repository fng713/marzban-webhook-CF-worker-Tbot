
<p align="center">
 <a href="./README.md">
 English
 </a>
 /
 <a href="./README-fa.md">
 فارسی
 </a>
</p>

# لیسنر وبهوک تلگرام

این یک لیسنر وبهوک سرورلس بر پایه جاوا اسکریپت است که اعلان‌های سیستم [وبهوک مرزبان](https://gozargah.github.io/marzban/en/docs/webhook) را پردازش کرده و داده‌های ورودی را به چت تلگرام ارسال می‌کند.

## ویژگی‌ها

- دریافت درخواست‌های POST با بار JSON از مرزبان.
- مدیریت رویدادهای کاربران مانند ایجاد، به‌روزرسانی، انقضا و محدودیت‌ها.
- تایید درخواست‌ها با استفاده از یک کلید مخفی برای امنیت.
- ارسال خودکار اعلان‌های مربوط به رویدادهای کاربران به چت تلگرام مشخص.

## پیش‌نیازها

1. **توکن ربات تلگرام**: این توکن را با ساخت یک ربات از طریق [BotFather](https://core.telegram.org/bots#botfather) دریافت کنید.
2. **شناسه چت ادمین**: چتی که اعلان‌ها به آن ارسال می‌شود را مشخص کنید.
3. **کلید مخفی وبهوک**: برای تایید و امنیت درخواست‌ها از این کلید استفاده کنید.

## داده‌های پشتیبانی‌شده وبهوک مرزبان

وبهوک مرزبان اعلان‌های مربوط به رویدادهای خاص کاربران را ارسال می‌کند. داده‌های کلیدی شامل:

- **username**: نام کاربری مربوط به رویداد.
- **action**: نوع رویداد (مانند `ایجاد کاربر`، `به‌روزرسانی کاربر`، `انقضای کاربر`).
- **enqueued_at**: زمان ثبت رویداد.
- **tries**: تعداد دفعات تلاش در صورت عدم ارسال موفق.
- **فیلدهای اضافی**:
  - **admin**: ادمین مسئول کاربر.
  - **status**: وضعیت فعلی کاربر (مانند فعال، غیرفعال).
  - **data_limit**: مقدار محدودیت داده به بایت.
  - **expire**: زمان انقضای کاربر به فرمت یونیکس.
  - **note**: یادداشت‌های مرتبط با کاربر.

### مثال بار ورودی و پیام تلگرام

بار JSON ورودی از مرزبان:

```json
{
  "username": "example_user",
  "action": "user_created",
  "enqueued_at": 1680506457.636369,
  "tries": 0,
  "user": {
    "admin": { "username": "admin_user" },
    "status": "active",
    "data_limit": 5368709120,
    "expire": 1700000000,
    "note": "Welcome package"
  }
}
```

پیام فرمت‌شده در تلگرام:

```
رویداد: ایجاد کاربر
نام کاربری: example_user
ادمین: admin_user
وضعیت: فعال
حجم داده: 5 گیگابایت
انقضا: 30 روز
یادداشت: Welcome package
```

## استقرار

1. اسکریپت را در یک پلتفرم سرورلس مانند [Cloudflare Workers](https://workers.cloudflare.com/) یا [AWS Lambda](https://aws.amazon.com/lambda/) مستقر کنید.
2. مرزبان را طوری تنظیم کنید که اعلان‌های وبهوک را به URL مستقر شما ارسال کند.
3. یکپارچگی را با ایجاد رویدادهای کاربری در مرزبان آزمایش کنید.

## منابع

- [مستندات وبهوک مرزبان](https://gozargah.github.io/marzban/en/docs/webhook)
- [مستندات API تلگرام](https://core.telegram.org/bots/api)

<h1 align="left">حمایت از من</h1>
<p align="left">https://nowpayments.io/donation/FNG</p>
